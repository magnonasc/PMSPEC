package br.uniriotec.bsi.pmspec.impl;

import br.uniriotec.bsi.pmspec.PMSpec;
import br.uniriotec.bsi.pmspec.api.LeitorMunicipios;
import br.uniriotec.bsi.pmspec.model.AreaMunicipio;
import br.uniriotec.bsi.pmspec.model.Coordenada;
import br.uniriotec.bsi.pmspec.model.Municipio;
import br.uniriotec.bsi.pmspec.model.Poligono;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.xml.sax.SAXException;

import javax.annotation.Nonnull;
import javax.inject.Inject;
import javax.inject.Singleton;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import java.io.BufferedInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.URISyntaxException;
import java.net.URL;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.List;

import static com.google.common.base.Preconditions.*;

/**
 * Leitor dos municípios registrados em um arquivo KML.
 *
 * @author Magno Nascimento
 * @implNote Esta classe é específica para este tipo de arquivo e formato e não deve ser utilizada para outros fins.
 * <p>
 * O município deve conter as seguintes propriedades no arquivo:
 * <pre><code>
 * <Placemark> <!-- Delimitador do município. -->
 * 		<ExtendedData>
 * 			<SchemaData schemaUrl="#55mu2500gsr">
 * 				<SimpleData name="GEOCODIGO_MUNICIPIO">1100015</SimpleData> <!-- Código do município pelo IBGE. -->
 * 				<SimpleData name="SIGLA">RO</SimpleData> <!-- Sigla da UF na qual o município pertence. -->
 * 				<SimpleData name="NOME_MUNICIPIO">Alta Floresta D&apos;Oeste</SimpleData> <!-- Nome do município. -->
 * 			</SchemaData>
 * 		</ExtendedData>
 * 		<Polygon>
 * 			<outerBoundaryIs>
 * 				<LinearRing>
 * 					<coordinates> <!-- Coordenadas delimitando os limites do município. -->
 * 						-62.18254881082289,-11.86729196449489,0 -62.16275528088946,-11.8718313187172,0 -62.15752323637058,-11.87084789249371,0 -62.14062963433307,-11.85268956845633,0 -62.12711192049035,-11.84516968421771,0 -62.12402259897746,-11.84690281982229,0 -62.11996656442082,-11.84295866709167,0 -62.1106070140203,-11.84245291472622,0 -62.10238218663148,-11.84534806855082,0 -62.09206211392684,-11.84006499125877,0 -62.08397429691806,-11.87655188457432,0 -62.072031534571,-11.8770351098398,0 -62.06223533761516,-11.86873013092451,0 -62.05295646106046,-11.86725139118209,0 -62.05036737532364,-11.8673826299327,0 -62.03191562111717,-11.86489392590851,0 -62.02863739566681,-11.86051652955011,0 -62.01971584318258,-11.85783841826201,0 -62.00715600222849,-11.86814266747679,0 -61.99460766715137,-11.86916183826809,0 -61.97970106864171,-11.86487054690869,0 -61.97188246862469,-11.86796689374486,0 -61.96677024038546,-11.86363762494543,0 -61.96174240148515,-11.86911006923683,0 -61.95246727787574,-11.86430691590647,0 -61.94013396468831,-11.86391179675812,0 -61.93282605467287,-11.86273585865939,0 -61.9295193051957,-11.86641472569832,0 -61.92102193402234,-11.86689974772623,0 -61.92329837794652,-11.87733165672416,0 -61.91894020083873,-11.89070430792831,0 -61.90540682854898,-11.89209008235072,0 -61.9004127831009,-11.89207090409805,0 -61.89510362879917,-11.9046656707764,0 -61.89045686646384,-11.90684227871528,0 -61.88644092317787,-11.9088606697723,0 -61.88706055611805,-11.92718541835628,0 -61.88836548198068,-11.96574184046168,0 -61.90182987951567,-11.96558337652322,0 -61.91374661622835,-11.97637153137808,0 -61.91746142709852,-11.97600237599887,0 -61.92419664196974,-11.97241585740728,0 -61.93067734264696,-11.97352564174702,0 -61.93511791004537,-11.98269623049281,0 -61.92979180008069,-11.98568978329003,0 -61.92952216262943,-12.08728751280242,0 -61.96819736139847,-12.08737908235166,0 -61.96829200283756,-12.13236833122969,0 -61.96840816849647,-12.13410151290807,0 -61.99292819839217,-12.13392573112298,0 -62.00799454442836,-12.13381715442535,0 -62.00777416319723,-12.26916372570893,0 -62.00052375677177,-12.27005708783803,0 -62.00052318780342,-12.27118871131303,0 -62.0004495346503,-12.45640288090569,0 -62.00044518241808,-12.50009370432539,0 -62.00045493007809,-12.61050836662831,0 -62.00053402686429,-12.79216437024254,0 -62.01919570385406,-12.82089259937679,0 -62.02511284260766,-12.84831282001269,0 -62.02372173575463,-12.8722546403706,0 -62.03055423274103,-12.89488860047227,0 -62.03955503513634,-12.90750006005217,0 -62.07126572613618,-12.90715746418236,0 -62.09219736499739,-12.91455208831881,0 -62.09166579779373,-12.92361088693268,0 -62.09853214057617,-12.92808515328899,0 -62.10405617280205,-12.94798137746435,0 -62.10955993811478,-12.95415406276175,0 -62.1135043546591,-12.95352362355169,0 -62.1235007395011,-12.96550416729795,0 -62.13041651501415,-12.96264875699931,0 -62.14178328955651,-12.97069985437468,0 -62.1441733552327,-12.96934399829561,0 -62.15117093113427,-12.97773484816537,0 -62.16053174180632,-12.98028350996105,0 -62.16536684686936,-13.00066861259006,0 -62.16541837913995,-13.00436261434479,0 -62.17174924528264,-13.00728318053006,0 -62.17339274452731,-13.01514071645947,0 -62.17984027535784,-13.02051851769834,0 -62.18317141453753,-13.01997735411074,0 -62.19369585065277,-13.02860457431083,0 -62.20683615932083,-13.02744142084278,0 -62.21219745784996,-13.03081891947954,0 -62.21645231955447,-13.03984004745777,0 -62.24150565362674,-13.04812350338736,0 -62.24226104902999,-13.05497651071222,0 -62.24928224653058,-13.06053191206275,0 -62.24545204779948,-13.06599920444542,0 -62.25177972106436,-13.07843592385916,0 -62.27440390396673,-13.08516681137978,0 -62.28251507815506,-13.08779171949618,0 -62.29244812871023,-13.08475734697975,0 -62.29595044710517,-13.07802063268781,0 -62.29883888196498,-13.09562235526332,0 -62.30550171794724,-13.09399527096789,0 -62.30906597623218,-13.09656784441306,0 -62.31053850836974,-13.10629061124312,0 -62.31692307362527,-13.10952501296431,0 -62.32056231579998,-13.10202984525421,0 -62.31978477684094,-13.08038730912479,0 -62.32608885904686,-13.07662077305441,0 -62.336367306871,-13.07967785078232,0 -62.3456740382849,-13.0575592831349,0 -62.35355703702763,-13.05824741922911,0 -62.35609440130298,-13.0702457573093,0 -62.35331225848861,-13.0788295469648,0 -62.35659050142199,-13.08351713051215,0 -62.36303281256694,-13.08546737024257,0 -62.36375488625878,-13.07741343059934,0 -62.36853650487394,-13.08075169965822,0 -62.37133843499866,-13.09261285256932,0 -62.38328254258921,-13.10413759568134,0 -62.38787022305737,-13.10687255530676,0 -62.4031414837596,-13.1049755418798,0 -62.41045451613185,-13.10734358690227,0 -62.41764603921154,-13.11898044537588,0 -62.43439162832888,-13.10200402374071,0 -62.43333985489601,-13.08585194912717,0 -62.43692357881918,-13.08060775283441,0 -62.44284349567674,-13.07994986824343,0 -62.45181257130441,-13.08781483575724,0 -62.45739254256675,-13.08671106123482,0 -62.45903648726161,-13.0811457272589,0 -62.45234580182762,-13.07027932958911,0 -62.45394875473334,-13.06482993361826,0 -62.46033940194578,-13.06556195448539,0 -62.46548217029858,-13.07723636856553,0 -62.47197990684679,-13.0789248397323,0 -62.47350917504027,-13.06039115720863,0 -62.47887167800276,-13.05748727089624,0 -62.48345037045655,-13.06218982161822,0 -62.48298174261073,-13.07616061476906,0 -62.50256499306765,-13.08320164553091,0 -62.52375285680704,-13.06554172650826,0 -62.53490001957761,-13.07332168932148,0 -62.54709447723047,-13.074032445097,0 -62.55797443530648,-13.06565779317425,0 -62.61250692992982,-13.04133443857742,0 -62.61406701654876,-13.02627778391078,0 -62.60014542959127,-13.01678856658002,0 -62.60675850425809,-13.01107309594281,0 -62.62145441957906,-13.01774757853515,0 -62.62917021336585,-13.01629388147204,0 -62.63295809587262,-13.010676444334,0 -62.62911208310656,-12.9958510534134,0 -62.63139736282135,-12.99025455607921,0 -62.63884111060555,-12.98919567168376,0 -62.64642399723551,-12.99318798002052,0 -62.65211801021611,-12.98937429655523,0 -62.64520393539645,-12.97463356826195,0 -62.64539713074312,-12.96775681804886,0 -62.65075724195233,-12.9656194877308,0 -62.66062198280652,-12.96951070111984,0 -62.66447902398126,-12.98070204586022,0 -62.67484421364685,-12.99099031594358,0 -62.69431254796959,-12.99227101147354,0 -62.69851150777934,-13.00285544785185,0 -62.70686748638768,-12.99993047852567,0 -62.71314678648598,-13.00436582108803,0 -62.72509366835396,-13.00129430321221,0 -62.72886877727154,-13.00870161590209,0 -62.72909272507732,-13.02080605101151,0 -62.73395484375462,-13.02190628274005,0 -62.74415010603124,-13.0088994898095,0 -62.74378408749446,-13.00035942917037,0 -62.74684259577475,-12.99894981816753,0 -62.752145132274,-13.00208538416841,0 -62.7563433346519,-13.01723095447014,0 -62.7790316774972,-13.00961317114882,0 -62.79428540628464,-12.9952573339436,0 -62.80680364075283,-12.96814229945504,0 -62.80883590828748,-12.96217694160401,0 -62.80323469902543,-12.94511916641807,0 -62.80589794864375,-12.94066577096167,0 -62.8229253197119,-12.93380875115635,0 -62.83203177673538,-12.93786113565963,0 -62.83884392067935,-12.94737978826197,0 -62.84578134020245,-12.94875768157523,0 -62.85019821001062,-12.9409724446469,0 -62.84306024913683,-12.92716102174304,0 -62.86083757004946,-12.91293685463473,0 -62.87014360993667,-12.91065742745615,0 -62.88047678133982,-12.88724843240948,0 -62.89308946060282,-12.87715837416673,0 -62.89208995955151,-12.85888036235163,0 -62.88111607234432,-12.86320734316984,0 -62.87756301521434,-12.87268849036138,0 -62.87194893143435,-12.87841159377965,0 -62.86575734828536,-12.87929129711307,0 -62.85865165256664,-12.87049631233515,0 -62.8510376201998,-12.86998962773211,0 -62.84256079105199,-12.86358337219384,0 -62.81761865687953,-12.86813419475702,0 -62.79764401934438,-12.86471949109642,0 -62.80106339754102,-12.8610285923392,0 -62.79492878759336,-12.85958642904056,0 -62.78837425301507,-12.86138672453037,0 -62.78845069826886,-12.87751087076039,0 -62.7776991098826,-12.87583612332926,0 -62.77383522027664,-12.88210965520311,0 -62.76731505020867,-12.88390874047724,0 -62.76645105787488,-12.87819507695162,0 -62.75791980234757,-12.87755688499961,0 -62.76211874180577,-12.87610320147003,0 -62.75945300789748,-12.87339888219277,0 -62.75197772557233,-12.87318971008924,0 -62.75408986427338,-12.88592057042585,0 -62.74914383910346,-12.88678981264446,0 -62.75006767007866,-12.88312951931076,0 -62.7446785990756,-12.88253203347911,0 -62.73428924948671,-12.89172694218509,0 -62.73789399825867,-12.89491846800644,0 -62.73722886528358,-12.90539712479685,0 -62.74125784564529,-12.91174094258958,0 -62.7378374296831,-12.91593298512945,0 -62.73420531323922,-12.91384367403007,0 -62.73036294115136,-12.9273445707245,0 -62.72445442235388,-12.92792459464848,0 -62.71650750041249,-12.92218389079143,0 -62.70337225577259,-12.92091753642785,0 -62.69401042127033,-12.90232324244897,0 -62.66519710182725,-12.90621977881685,0 -62.65256257697008,-12.90212543640114,0 -62.64916795745173,-12.89943615295716,0 -62.64484496050175,-12.88237166587033,0 -62.6227576703698,-12.87193372638286,0 -62.61731492665716,-12.86587172855477,0 -62.61670272846251,-12.86401891831237,0 -62.61427120841361,-12.85804402955316,0 -62.5948660485809,-12.83816498044458,0 -62.59092182769515,-12.82689192675685,0 -62.5780025984017,-12.8099137589483,0 -62.56019957153455,-12.81049515030984,0 -62.54755907494939,-12.79676136084096,0 -62.5341113324918,-12.80648277909513,0 -62.52186870016128,-12.80963062923208,0 -62.51770312890858,-12.78291363770318,0 -62.50208106654546,-12.75976151083992,0 -62.49945006513705,-12.754515616849,0 -62.48875454415767,-12.75012112235171,0 -62.46414711672724,-12.74828910033301,0 -62.45219372809368,-12.72751481948412,0 -62.42419926144991,-12.70730712562809,0 -62.41667069342176,-12.68585227655976,0 -62.40958589696389,-12.68018323325805,0 -62.40485536334079,-12.66724652924601,0 -62.40097150402887,-12.66060572395946,0 -62.39011729077213,-12.65960179229679,0 -62.38591587321125,-12.6464200962029,0 -62.37803308018219,-12.63934525645091,0 -62.36770114222086,-12.62115894997516,0 -62.36167032906906,-12.60008085974622,0 -62.35100121747646,-12.59226298432826,0 -62.34374022006917,-12.58083855843057,0 -62.32655966438069,-12.57366818219226,0 -62.31266907699298,-12.55756782265397,0 -62.29866704618343,-12.54815500688484,0 -62.28942178125207,-12.53524765259619,0 -62.28013578039388,-12.52985418442191,0 -62.2677560432923,-12.50980547032473,0 -62.27052805311359,-12.48857802338899,0 -62.26833587946073,-12.48104228198958,0 -62.2719741593667,-12.48055576079989,0 -62.2750254783422,-12.47325579499861,0 -62.26736127873851,-12.45657160209987,0 -62.25875336347374,-12.45094812121202,0 -62.26205410425314,-12.43614402934608,0 -62.25883450937663,-12.43328540603585,0 -62.26416734541007,-12.42736654471645,0 -62.25202634215839,-12.42257515253634,0 -62.25511623692923,-12.4144317177702,0 -62.25196994105266,-12.40980652570979,0 -62.25566775077488,-12.41038370938656,0 -62.25085972785309,-12.40206725974455,0 -62.2838402767523,-12.33431115632112,0 -62.29136126529264,-12.31885977860728,0 -62.30041507852488,-12.31640188872182,0 -62.30665960161565,-12.32102288764255,0 -62.32878626850044,-12.32594589693915,0 -62.35525037404615,-12.3321783273292,0 -62.36355458336817,-12.33874009356313,0 -62.37339131699999,-12.33798379945223,0 -62.38055740902658,-12.34259103291231,0 -62.39461519388011,-12.34351459309533,0 -62.40678096521094,-12.33249926237312,0 -62.41594252051134,-12.32874657088199,0 -62.41753229495513,-12.32420450928574,0 -62.43853066916643,-12.31671548133949,0 -62.44405867626396,-12.31043307124072,0 -62.46275151186626,-12.30168826507222,0 -62.46813756239564,-12.29929465099336,0 -62.47708450867691,-12.30290464989191,0 -62.48544607852735,-12.30208413394278,0 -62.48936267955554,-12.29609280296237,0 -62.49825105013786,-12.29706368726221,0 -62.50172257011202,-12.29355524433999,0 -62.51347054144458,-12.28564958531435,0 -62.52042235297788,-12.28343278424435,0 -62.5355844556527,-12.28496826433715,0 -62.5561112385423,-12.27505492540313,0 -62.55999883510736,-12.26932335247164,0 -62.56761461366956,-12.27218397338306,0 -62.57627854359058,-12.26763877319165,0 -62.58244319495934,-12.25960968382519,0 -62.5826657425808,-12.25289199679978,0 -62.59283329911821,-12.24910471916085,0 -62.60281046772023,-12.25135363181127,0 -62.60836764451795,-12.25625611473806,0 -62.60928350805997,-12.25389068780349,0 -62.62221992570172,-12.25435766046242,0 -62.64245370748815,-12.23721827169658,0 -62.63428368265234,-12.21866030539214,0 -62.62202872377176,-12.20773965077891,0 -62.61752858462562,-12.20902330021899,0 -62.61291304559722,-12.19964648953779,0 -62.61580678269313,-12.19705990248627,0 -62.61444662058104,-12.18887966124797,0 -62.6208878384407,-12.18337507738108,0 -62.61478231171424,-12.17063443355126,0 -62.60389286258045,-12.15879398094392,0 -62.60244488167034,-12.15047021598725,0 -62.60972461082574,-12.12858443187852,0 -62.606745335534,-12.12624237826413,0 -62.61385695166374,-12.11996760933681,0 -62.60769307000838,-12.1117896567533,0 -62.60455255382399,-12.11187528888657,0 -62.60978134200549,-12.10128436783251,0 -62.60628273495228,-12.10083515057547,0 -62.60847168773973,-12.09635355126433,0 -62.60625213372595,-12.09247233715535,0 -62.60985693319439,-12.09171499448873,0 -62.60646641648071,-12.0897100665924,0 -62.61008026108524,-12.08949107859667,0 -62.61138805403446,-12.08501508128558,0 -62.58846846274264,-12.06927815762995,0 -62.58166803448104,-12.0727076791838,0 -62.58094389641544,-12.06961241852858,0 -62.57702591287712,-12.07008263034331,0 -62.56491365243,-12.05943310636023,0 -62.54513658852422,-12.04872505909518,0 -62.54733415205553,-12.03922689192228,0 -62.54416218137525,-12.03454547464429,0 -62.53880176455412,-12.03330107048582,0 -62.53785555838615,-12.0292026555895,0 -62.52296816715726,-12.02479433511408,0 -62.51646485075578,-12.01582687303325,0 -62.48850091351252,-12.00487305955676,0 -62.48336183538175,-11.99656721951573,0 -62.47943928253233,-11.99598942127528,0 -62.48046843233129,-11.98846589878347,0 -62.47552411184356,-11.98252811901522,0 -62.46799925006989,-11.98213476734365,0 -62.46460676842579,-11.97332107530626,0 -62.45441537951072,-11.9701069457577,0 -62.45409832621711,-11.96975033705835,0 -62.44811175133208,-11.9610509571057,0 -62.44118918834678,-11.95880370352291,0 -62.43821690932057,-11.94538485346226,0 -62.42878441432635,-11.93758242522818,0 -62.42824760974442,-11.93373252133267,0 -62.42330129676676,-11.93392477602609,0 -62.40608388836798,-11.92391410276283,0 -62.40721734829407,-11.91547546261935,0 -62.39154303545393,-11.90851895596055,0 -62.37971705376528,-11.90488093488771,0 -62.37447179574497,-11.9090008336178,0 -62.35788907995059,-11.90393314806933,0 -62.35032768156163,-11.90486658261126,0 -62.34697166305684,-11.89905634520999,0 -62.34118885824859,-11.90030890526926,0 -62.33715764167007,-11.89552800334821,0 -62.33036006865751,-11.8960597626923,0 -62.32130495777303,-11.90302820131267,0 -62.31871912886525,-11.90096574141105,0 -62.31577476155048,-11.90467856791214,0 -62.31582938469661,-11.9013634477888,0 -62.31247323284632,-11.90362534845601,0 -62.31130809454451,-11.90108173227957,0 -62.30715970306156,-11.89833856848678,0 -62.30475872333948,-11.90081608048217,0 -62.29931398408766,-11.89269731097526,0 -62.29060259691025,-11.89503246128576,0 -62.29152527977025,-11.89935973737175,0 -62.2880806539652,-11.90086476889907,0 -62.28366143963454,-11.8991703073549,0 -62.27841374436395,-11.90427964578081,0 -62.27363446689555,-11.90200990166581,0 -62.26758030975788,-11.90612544274249,0 -62.25816797143347,-11.90104210464071,0 -62.25774616756127,-11.90341914835719,0 -62.24612959556158,-11.90152332921303,0 -62.24144041997333,-11.90330218918069,0 -62.24383034148475,-11.90576716509693,0 -62.24127101821998,-11.90831181157998,0 -62.23594105341264,-11.91037428310172,0 -62.23216742165178,-11.90806832866121,0 -62.22623086050021,-11.89039996770831,0 -62.20663050120177,-11.8320248102307,0 -62.1992156610067,-11.8279090136096,0 -62.18938427997176,-11.82797704317588,0 -62.17324749874143,-11.85225167397297,0 -62.18254881082289,-11.86729196449489,0
 * 					</coordinates>
 * 				</LinearRing>
 * 			</outerBoundaryIs>
 * 		</Polygon>
 * 	</Placemark>
 * 	</code></pre>
 *
 * 	Ou em casos de municípios com multiplos polígonos de área:
 * <code><pre>
 * 	<Placemark> <!-- Delimitador do município. -->
 * 		<ExtendedData>
 * 			<SchemaData schemaUrl="#55mu2500gsr">
 * 				<SimpleData name="GEOCODIGO_MUNICIPIO">3304557</SimpleData> <!-- Código do município pelo IBGE. -->
 * 				<SimpleData name="SIGLA">RJ</SimpleData> <!-- Sigla da UF na qual o município pertence. -->
 * 				<SimpleData name="NOME_MUNICIPIO">Rio de Janeiro</SimpleData> <!-- Nome do município. -->
 * 			</SchemaData>
 * 		</ExtendedData>
 * 		<MultiGeometry> <!-- Delimitador da área do município. -->
 * 			<Polygon>
 * 				<outerBoundaryIs>
 * 					<LinearRing>
 * 						<coordinates> <!-- Coordenadas delimitando os limites do polígono. -->
 * 							-43.3074829311733,-22.79838576200411,0 -43.29975885701564,-22.80616242357089,0 -43.29118562687095,-22.80999110186433,0 -43.28817967227705,-22.80837344069716,0 -43.28331814629831,-22.81661789603389,0 -43.2739078203109,-22.81101216455471,0 -43.27578827395285,-22.81883592188269,0 -43.26765260270811,-22.82240832545445,0 -43.25575791627926,-22.8369394061285,0 -43.24468320123614,-22.84276819482698,0 -43.24191115036937,-22.8584492971137,0 -43.23921157548855,-22.86290370727267,0 -43.24290266587292,-22.86857129092437,0 -43.23798711467163,-22.8771635207209,0 -43.23050983934701,-22.8714364276729,0 -43.2260434642509,-22.87572331380584,0 -43.22309230093685,-22.87367082462323,0 -43.21806701007474,-22.87637524397006,0 -43.20934799098625,-22.86896969776498,0 -43.20130390078869,-22.8765533231224,0 -43.21137289784667,-22.88737292466238,0 -43.20857757062847,-22.89323003917457,0 -43.18967612323286,-22.88856562244628,0 -43.17999622936835,-22.89169006131176,0 -43.18168593820835,-22.89512473305327,0 -43.1789472335817,-22.89210921655037,0 -43.17940209796703,-22.8957695180078,0 -43.17482921808923,-22.89313015026999,0 -43.16730251400715,-22.8954512185575,0 -43.17180449811109,-22.89801110174334,0 -43.1678748498837,-22.89966425818405,0 -43.16574245236082,-22.8967321587626,0 -43.16782784203889,-22.89976276272359,0 -43.17698639284703,-22.8964009444829,0 -43.16914266440607,-22.90457511338252,0 -43.16190955477535,-22.90463245757391,0 -43.16107611728948,-22.91257577932665,0 -43.15709191164922,-22.91319838560734,0 -43.16185803444004,-22.91769028001412,0 -43.16883860516951,-22.91458309804738,0 -43.17286495114784,-22.91699879607692,0 -43.17067090954892,-22.91999753541922,0 -43.16903729932246,-22.9173147194571,0 -43.16709179841349,-22.92261760792765,0 -43.17095591414343,-22.93245941152656,0 -43.16820287129303,-22.93838927546939,0 -43.17418807954778,-22.94409507222551,0 -43.17971887729513,-22.94404279897642,0 -43.18059968313226,-22.9479691124097,0 -43.16992926644873,-22.95224409629214,0 -43.16229074138182,-22.9435175659189,0 -43.15159745673143,-22.93866584118813,0 -43.15564463375449,-22.94344588517395,0 -43.15022193305346,-22.95070133928855,0 -43.16422848430819,-22.95443731579327,0 -43.15978594924877,-22.95751419448593,0 -43.16038096762298,-22.96141139820098,0 -43.15896911470566,-22.96425913772709,0 -43.16785132675161,-22.96378700580433,0 -43.18228755166952,-22.97210389167788,0 -43.18697483398395,-22.98210603619161,0 -43.18131889760136,-22.98600961861353,0 -43.1873674933124,-22.98802507134626,0 -43.1911304496595,-22.99088183226722,0 -43.22220084262257,-22.98884466215003,0 -43.24382703877534,-23.00158410163279,0 -43.27541248358423,-23.00334416817375,0 -43.28629247183802,-23.0091924749043,0 -43.28632602427865,-23.01650976636683,0 -43.29674861966517,-23.01699073594416,0 -43.29445940433143,-23.01199741710959,0 -43.30179185218125,-23.00906988851898,0 -43.30628888225461,-23.00100972599247,0 -43.31193656542263,-22.99740269779791,0 -43.32012721481884,-22.99746183316004,0 -43.32368028066611,-22.99064851524691,0 -43.33437759793185,-22.99005808712622,0 -43.34282118254099,-22.98227794363616,0 -43.34849453437005,-22.98007156789439,0 -43.35138615228392,-22.978946500816,0 -43.36437756289499,-22.97389131199379,0 -43.37646014876881,-22.97608843326713,0 -43.38306834616876,-22.97406647055934,0 -43.39434616507754,-22.98367399167789,0 -43.40395765113571,-22.97525011364712,0 -43.4064636876505,-22.9790570039332,0 -43.40340953212113,-22.9852987630351,0 -43.40645840749292,-22.98098404607043,0 -43.41543340122091,-22.98768768167033,0 -43.41248548587004,-22.98665443817641,0 -43.41285383248613,-22.98965999718278,0 -43.40765930170895,-22.99241353762874,0 -43.39065824089059,-22.98853322410825,0 -43.38864975496386,-22.99266552226445,0 -43.39215165235935,-22.99436041477742,0 -43.38912386931912,-22.99482050032967,0 -43.38587738751189,-22.99011764070064,0 -43.3877977861535,-22.98301632652146,0 -43.38115658232545,-22.97833799490546,0 -43.35023870872651,-22.97958147425122,0 -43.34490398441363,-22.98468146437648,0 -43.3577606116181,-22.9853380806451,0 -43.35001595682464,-22.98780437077555,0 -43.3469274844179,-22.99234410110415,0 -43.35178617764092,-22.99421275583597,0 -43.35806933274412,-22.99020328243462,0 -43.36031753307397,-22.99380613654695,0 -43.32384859767575,-22.99629095763682,0 -43.32295737875344,-23.00072006161541,0 -43.3171022429486,-23.00043648125028,0 -43.3111237411609,-23.00648927996885,0 -43.29573457367145,-23.01256425763417,0 -43.30594656896994,-23.01627066827002,0 -43.35856797725616,-23.0111955014696,0 -43.44371546884454,-23.02200070718876,0 -43.46612359150683,-23.02955345421193,0 -43.47040629640794,-23.03368141458138,0 -43.46901396971223,-23.03798074860229,0 -43.47331430476949,-23.03252401484503,0 -43.4942351866359,-23.03516554875416,0 -43.50665191603966,-23.04273493189493,0 -43.5085188492456,-23.04799911328296,0 -43.53615518497361,-23.05184279142818,0 -43.53729388440494,-23.05621235285695,0 -43.54949140460445,-23.06248898411592,0 -43.55271175961818,-23.07121576885855,0 -43.54990445528532,-23.07336124964307,0 -43.55407289776149,-23.07658900188408,0 -43.55758169705548,-23.07429375749644,0 -43.57232006291253,-23.07386094575715,0 -43.56854141486171,-23.07161501752467,0 -43.5687945962827,-23.06347178295892,0 -43.57738052030078,-23.05723808463631,0 -43.59507785460917,-23.05257642155724,0 -43.6685150649566,-23.05404773364516,0 -43.66708129602399,-23.04278127071145,0 -43.61451860130052,-23.03182420489906,0 -43.60593578213821,-23.03480350383364,0 -43.60307575651215,-23.04040263675347,0 -43.568408054709,-23.05399341609707,0 -43.56800253213069,-23.06462165354997,0 -43.55914926393907,-23.0542002493166,0 -43.55718520103872,-23.04912786413819,0 -43.55960365098622,-23.04837154941136,0 -43.56365042244395,-23.04598784203154,0 -43.56395794435493,-23.05385508022241,0 -43.57246065788529,-23.04980134485272,0 -43.58037417599982,-23.03988221276539,0 -43.57965712384679,-23.04331695860432,0 -43.58843637394944,-23.0359503359665,0 -43.58576903249491,-23.03578672817913,0 -43.59460042069215,-23.0327632102156,0 -43.59976674253414,-23.0236709221507,0 -43.62563015487751,-23.00766155427238,0 -43.63957140749221,-23.00683218866424,0 -43.64407591184987,-23.00204780036667,0 -43.65365880152615,-23.00345579351669,0 -43.66454767989825,-22.98729729403769,0 -43.67754641801127,-22.98104793066906,0 -43.68726310590225,-22.98667203390894,0 -43.69023401198964,-22.99243633341459,0 -43.69569043766753,-22.98546723318585,0 -43.70099029255021,-22.98617194720487,0 -43.71338081968043,-22.97028667074867,0 -43.72078908977728,-22.97426168707585,0 -43.71940781998131,-22.96702177384045,0 -43.73009584042191,-22.95519336090842,0 -43.74976300023545,-22.94632400058426,0 -43.76370683969532,-22.935808985445,0 -43.76368197106436,-22.93100307059972,0 -43.76821520922119,-22.9323196923546,0 -43.77740492948188,-22.92504612450996,0 -43.77546502952286,-22.92123364193018,0 -43.78454454929908,-22.92367749435001,0 -43.79498293343551,-22.91768659945895,0 -43.79157579647344,-22.91365602206024,0 -43.79435249517412,-22.90382927154789,0 -43.78746193634426,-22.90063231195845,0 -43.78427138380993,-22.90393124135819,0 -43.78026561389837,-22.89554127566768,0 -43.77477054155938,-22.89688876879151,0 -43.77302143235814,-22.89315195615147,0 -43.76717877577416,-22.89547635990448,0 -43.76396740314256,-22.89247340748949,0 -43.75135324219646,-22.88837170458307,0 -43.74967221129459,-22.87878943265257,0 -43.73331415699003,-22.87771025720199,0 -43.69782137026321,-22.8648614802122,0 -43.6744871413393,-22.86467158131882,0 -43.66273830735002,-22.86457771690438,0 -43.6442904286673,-22.85620607260736,0 -43.62486590135606,-22.86269088755696,0 -43.59718740772063,-22.85777807046397,0 -43.59349073310727,-22.86036012872119,0 -43.58824039050483,-22.83859765930753,0 -43.57629786057256,-22.83288902721557,0 -43.56722224820527,-22.83106148345029,0 -43.5356474090834,-22.8246998436024,0 -43.5163224974007,-22.82080351976459,0 -43.49475076609181,-22.81668937797733,0 -43.49037363656808,-22.81598764001695,0 -43.48518288191387,-22.83051825726571,0 -43.47001294483741,-22.84085422313577,0 -43.46387189204108,-22.84549780022352,0 -43.45801525136694,-22.8492556413142,0 -43.42574337582992,-22.83434933650312,0 -43.41487852901838,-22.82108501945296,0 -43.39173267692994,-22.81421469201989,0 -43.39004838572065,-22.81406118439558,0 -43.3769701058649,-22.81057365125386,0 -43.35893047662967,-22.80315854089121,0 -43.33057219909031,-22.80204440439408,0 -43.32766730644467,-22.80222719580169,0 -43.32054226086412,-22.79996410131313,0 -43.31398534961033,-22.80234948913223,0 -43.3074829311733,-22.79838576200411,0
 * 						</coordinates>
 * 					</LinearRing>
 * 				</outerBoundaryIs>
 * 			</Polygon>
 * 			<Polygon>
 * 				<outerBoundaryIs>
 * 					<LinearRing>
 * 						<coordinates> <!-- Coordenadas delimitando os limites do polígono. -->
 * 							-43.17254038371946,-22.77597940879172,0 -43.17129244194599,-22.78304794842813,0 -43.16589949433747,-22.77709621027228,0 -43.15751297471139,-22.77855048545752,0 -43.15711813771066,-22.78677183905761,0 -43.18201203374577,-22.80409866368808,0 -43.17787525668146,-22.80661477803198,0 -43.17545469357232,-22.82014263754505,0 -43.1657342737461,-22.82080174839999,0 -43.16948880081527,-22.82624469617248,0 -43.17340182057411,-22.83116231743727,0 -43.17617961239987,-22.82426765727207,0 -43.18523181594747,-22.83359445573394,0 -43.19176729576709,-22.82050482715918,0 -43.20448245428931,-22.81990163774285,0 -43.20934569223117,-22.815267887888,0 -43.22679238988715,-22.82048990722619,0 -43.24231504986426,-22.83335284715944,0 -43.24890081444494,-22.82952725657728,0 -43.24751409969936,-22.82559058472336,0 -43.25886918993504,-22.81973700040866,0 -43.2636526326801,-22.80929698404053,0 -43.25945478973082,-22.80422803210313,0 -43.25154659734849,-22.80815292184672,0 -43.24420804381983,-22.80756723143365,0 -43.24376280409971,-22.80064203086114,0 -43.22990497737888,-22.78798059173721,0 -43.2293728800333,-22.78313690051229,0 -43.21817610547485,-22.78569148153896,0 -43.208406403401,-22.79457453273635,0 -43.19029447280293,-22.79637772259226,0 -43.18981374105158,-22.78685657954992,0 -43.18298676389134,-22.78147719651942,0 -43.1784872277252,-22.78256735572554,0 -43.17511732109366,-22.77695539674232,0 -43.17254038371946,-22.77597940879172,0
 * 						</coordinates>
 *					</LinearRing>
 * 				</outerBoundaryIs>
 * 			</Polygon>
 * 		</MultiGeometry>
 * 	</Placemark>
 * 	</code></pre>
 *
 * 	Ou em casos de municípios sem informações sobre nome ou UF (casos especiais):
 * <pre><code>
 * <Placemark> <!-- Delimitador do município. -->
 * 		<ExtendedData>
 * 			<SchemaData schemaUrl="#55mu2500gsr">
 * 				<SimpleData name="GEOCODIGO_MUNICIPIO">1100015</SimpleData> <!-- Código do município pelo IBGE. -->
 * 			</SchemaData>
 * 		</ExtendedData>
 * 		<Polygon>
 * 			<outerBoundaryIs>
 * 				<LinearRing>
 * 					<coordinates> <!-- Coordenadas delimitando os limites do município. -->
 * 						-62.18254881082289,-11.86729196449489,0 -62.16275528088946,-11.8718313187172,0 -62.15752323637058,-11.87084789249371,0 -62.14062963433307,-11.85268956845633,0 -62.12711192049035,-11.84516968421771,0 -62.12402259897746,-11.84690281982229,0 -62.11996656442082,-11.84295866709167,0 -62.1106070140203,-11.84245291472622,0 -62.10238218663148,-11.84534806855082,0 -62.09206211392684,-11.84006499125877,0 -62.08397429691806,-11.87655188457432,0 -62.072031534571,-11.8770351098398,0 -62.06223533761516,-11.86873013092451,0 -62.05295646106046,-11.86725139118209,0 -62.05036737532364,-11.8673826299327,0 -62.03191562111717,-11.86489392590851,0 -62.02863739566681,-11.86051652955011,0 -62.01971584318258,-11.85783841826201,0 -62.00715600222849,-11.86814266747679,0 -61.99460766715137,-11.86916183826809,0 -61.97970106864171,-11.86487054690869,0 -61.97188246862469,-11.86796689374486,0 -61.96677024038546,-11.86363762494543,0 -61.96174240148515,-11.86911006923683,0 -61.95246727787574,-11.86430691590647,0 -61.94013396468831,-11.86391179675812,0 -61.93282605467287,-11.86273585865939,0 -61.9295193051957,-11.86641472569832,0 -61.92102193402234,-11.86689974772623,0 -61.92329837794652,-11.87733165672416,0 -61.91894020083873,-11.89070430792831,0 -61.90540682854898,-11.89209008235072,0 -61.9004127831009,-11.89207090409805,0 -61.89510362879917,-11.9046656707764,0 -61.89045686646384,-11.90684227871528,0 -61.88644092317787,-11.9088606697723,0 -61.88706055611805,-11.92718541835628,0 -61.88836548198068,-11.96574184046168,0 -61.90182987951567,-11.96558337652322,0 -61.91374661622835,-11.97637153137808,0 -61.91746142709852,-11.97600237599887,0 -61.92419664196974,-11.97241585740728,0 -61.93067734264696,-11.97352564174702,0 -61.93511791004537,-11.98269623049281,0 -61.92979180008069,-11.98568978329003,0 -61.92952216262943,-12.08728751280242,0 -61.96819736139847,-12.08737908235166,0 -61.96829200283756,-12.13236833122969,0 -61.96840816849647,-12.13410151290807,0 -61.99292819839217,-12.13392573112298,0 -62.00799454442836,-12.13381715442535,0 -62.00777416319723,-12.26916372570893,0 -62.00052375677177,-12.27005708783803,0 -62.00052318780342,-12.27118871131303,0 -62.0004495346503,-12.45640288090569,0 -62.00044518241808,-12.50009370432539,0 -62.00045493007809,-12.61050836662831,0 -62.00053402686429,-12.79216437024254,0 -62.01919570385406,-12.82089259937679,0 -62.02511284260766,-12.84831282001269,0 -62.02372173575463,-12.8722546403706,0 -62.03055423274103,-12.89488860047227,0 -62.03955503513634,-12.90750006005217,0 -62.07126572613618,-12.90715746418236,0 -62.09219736499739,-12.91455208831881,0 -62.09166579779373,-12.92361088693268,0 -62.09853214057617,-12.92808515328899,0 -62.10405617280205,-12.94798137746435,0 -62.10955993811478,-12.95415406276175,0 -62.1135043546591,-12.95352362355169,0 -62.1235007395011,-12.96550416729795,0 -62.13041651501415,-12.96264875699931,0 -62.14178328955651,-12.97069985437468,0 -62.1441733552327,-12.96934399829561,0 -62.15117093113427,-12.97773484816537,0 -62.16053174180632,-12.98028350996105,0 -62.16536684686936,-13.00066861259006,0 -62.16541837913995,-13.00436261434479,0 -62.17174924528264,-13.00728318053006,0 -62.17339274452731,-13.01514071645947,0 -62.17984027535784,-13.02051851769834,0 -62.18317141453753,-13.01997735411074,0 -62.19369585065277,-13.02860457431083,0 -62.20683615932083,-13.02744142084278,0 -62.21219745784996,-13.03081891947954,0 -62.21645231955447,-13.03984004745777,0 -62.24150565362674,-13.04812350338736,0 -62.24226104902999,-13.05497651071222,0 -62.24928224653058,-13.06053191206275,0 -62.24545204779948,-13.06599920444542,0 -62.25177972106436,-13.07843592385916,0 -62.27440390396673,-13.08516681137978,0 -62.28251507815506,-13.08779171949618,0 -62.29244812871023,-13.08475734697975,0 -62.29595044710517,-13.07802063268781,0 -62.29883888196498,-13.09562235526332,0 -62.30550171794724,-13.09399527096789,0 -62.30906597623218,-13.09656784441306,0 -62.31053850836974,-13.10629061124312,0 -62.31692307362527,-13.10952501296431,0 -62.32056231579998,-13.10202984525421,0 -62.31978477684094,-13.08038730912479,0 -62.32608885904686,-13.07662077305441,0 -62.336367306871,-13.07967785078232,0 -62.3456740382849,-13.0575592831349,0 -62.35355703702763,-13.05824741922911,0 -62.35609440130298,-13.0702457573093,0 -62.35331225848861,-13.0788295469648,0 -62.35659050142199,-13.08351713051215,0 -62.36303281256694,-13.08546737024257,0 -62.36375488625878,-13.07741343059934,0 -62.36853650487394,-13.08075169965822,0 -62.37133843499866,-13.09261285256932,0 -62.38328254258921,-13.10413759568134,0 -62.38787022305737,-13.10687255530676,0 -62.4031414837596,-13.1049755418798,0 -62.41045451613185,-13.10734358690227,0 -62.41764603921154,-13.11898044537588,0 -62.43439162832888,-13.10200402374071,0 -62.43333985489601,-13.08585194912717,0 -62.43692357881918,-13.08060775283441,0 -62.44284349567674,-13.07994986824343,0 -62.45181257130441,-13.08781483575724,0 -62.45739254256675,-13.08671106123482,0 -62.45903648726161,-13.0811457272589,0 -62.45234580182762,-13.07027932958911,0 -62.45394875473334,-13.06482993361826,0 -62.46033940194578,-13.06556195448539,0 -62.46548217029858,-13.07723636856553,0 -62.47197990684679,-13.0789248397323,0 -62.47350917504027,-13.06039115720863,0 -62.47887167800276,-13.05748727089624,0 -62.48345037045655,-13.06218982161822,0 -62.48298174261073,-13.07616061476906,0 -62.50256499306765,-13.08320164553091,0 -62.52375285680704,-13.06554172650826,0 -62.53490001957761,-13.07332168932148,0 -62.54709447723047,-13.074032445097,0 -62.55797443530648,-13.06565779317425,0 -62.61250692992982,-13.04133443857742,0 -62.61406701654876,-13.02627778391078,0 -62.60014542959127,-13.01678856658002,0 -62.60675850425809,-13.01107309594281,0 -62.62145441957906,-13.01774757853515,0 -62.62917021336585,-13.01629388147204,0 -62.63295809587262,-13.010676444334,0 -62.62911208310656,-12.9958510534134,0 -62.63139736282135,-12.99025455607921,0 -62.63884111060555,-12.98919567168376,0 -62.64642399723551,-12.99318798002052,0 -62.65211801021611,-12.98937429655523,0 -62.64520393539645,-12.97463356826195,0 -62.64539713074312,-12.96775681804886,0 -62.65075724195233,-12.9656194877308,0 -62.66062198280652,-12.96951070111984,0 -62.66447902398126,-12.98070204586022,0 -62.67484421364685,-12.99099031594358,0 -62.69431254796959,-12.99227101147354,0 -62.69851150777934,-13.00285544785185,0 -62.70686748638768,-12.99993047852567,0 -62.71314678648598,-13.00436582108803,0 -62.72509366835396,-13.00129430321221,0 -62.72886877727154,-13.00870161590209,0 -62.72909272507732,-13.02080605101151,0 -62.73395484375462,-13.02190628274005,0 -62.74415010603124,-13.0088994898095,0 -62.74378408749446,-13.00035942917037,0 -62.74684259577475,-12.99894981816753,0 -62.752145132274,-13.00208538416841,0 -62.7563433346519,-13.01723095447014,0 -62.7790316774972,-13.00961317114882,0 -62.79428540628464,-12.9952573339436,0 -62.80680364075283,-12.96814229945504,0 -62.80883590828748,-12.96217694160401,0 -62.80323469902543,-12.94511916641807,0 -62.80589794864375,-12.94066577096167,0 -62.8229253197119,-12.93380875115635,0 -62.83203177673538,-12.93786113565963,0 -62.83884392067935,-12.94737978826197,0 -62.84578134020245,-12.94875768157523,0 -62.85019821001062,-12.9409724446469,0 -62.84306024913683,-12.92716102174304,0 -62.86083757004946,-12.91293685463473,0 -62.87014360993667,-12.91065742745615,0 -62.88047678133982,-12.88724843240948,0 -62.89308946060282,-12.87715837416673,0 -62.89208995955151,-12.85888036235163,0 -62.88111607234432,-12.86320734316984,0 -62.87756301521434,-12.87268849036138,0 -62.87194893143435,-12.87841159377965,0 -62.86575734828536,-12.87929129711307,0 -62.85865165256664,-12.87049631233515,0 -62.8510376201998,-12.86998962773211,0 -62.84256079105199,-12.86358337219384,0 -62.81761865687953,-12.86813419475702,0 -62.79764401934438,-12.86471949109642,0 -62.80106339754102,-12.8610285923392,0 -62.79492878759336,-12.85958642904056,0 -62.78837425301507,-12.86138672453037,0 -62.78845069826886,-12.87751087076039,0 -62.7776991098826,-12.87583612332926,0 -62.77383522027664,-12.88210965520311,0 -62.76731505020867,-12.88390874047724,0 -62.76645105787488,-12.87819507695162,0 -62.75791980234757,-12.87755688499961,0 -62.76211874180577,-12.87610320147003,0 -62.75945300789748,-12.87339888219277,0 -62.75197772557233,-12.87318971008924,0 -62.75408986427338,-12.88592057042585,0 -62.74914383910346,-12.88678981264446,0 -62.75006767007866,-12.88312951931076,0 -62.7446785990756,-12.88253203347911,0 -62.73428924948671,-12.89172694218509,0 -62.73789399825867,-12.89491846800644,0 -62.73722886528358,-12.90539712479685,0 -62.74125784564529,-12.91174094258958,0 -62.7378374296831,-12.91593298512945,0 -62.73420531323922,-12.91384367403007,0 -62.73036294115136,-12.9273445707245,0 -62.72445442235388,-12.92792459464848,0 -62.71650750041249,-12.92218389079143,0 -62.70337225577259,-12.92091753642785,0 -62.69401042127033,-12.90232324244897,0 -62.66519710182725,-12.90621977881685,0 -62.65256257697008,-12.90212543640114,0 -62.64916795745173,-12.89943615295716,0 -62.64484496050175,-12.88237166587033,0 -62.6227576703698,-12.87193372638286,0 -62.61731492665716,-12.86587172855477,0 -62.61670272846251,-12.86401891831237,0 -62.61427120841361,-12.85804402955316,0 -62.5948660485809,-12.83816498044458,0 -62.59092182769515,-12.82689192675685,0 -62.5780025984017,-12.8099137589483,0 -62.56019957153455,-12.81049515030984,0 -62.54755907494939,-12.79676136084096,0 -62.5341113324918,-12.80648277909513,0 -62.52186870016128,-12.80963062923208,0 -62.51770312890858,-12.78291363770318,0 -62.50208106654546,-12.75976151083992,0 -62.49945006513705,-12.754515616849,0 -62.48875454415767,-12.75012112235171,0 -62.46414711672724,-12.74828910033301,0 -62.45219372809368,-12.72751481948412,0 -62.42419926144991,-12.70730712562809,0 -62.41667069342176,-12.68585227655976,0 -62.40958589696389,-12.68018323325805,0 -62.40485536334079,-12.66724652924601,0 -62.40097150402887,-12.66060572395946,0 -62.39011729077213,-12.65960179229679,0 -62.38591587321125,-12.6464200962029,0 -62.37803308018219,-12.63934525645091,0 -62.36770114222086,-12.62115894997516,0 -62.36167032906906,-12.60008085974622,0 -62.35100121747646,-12.59226298432826,0 -62.34374022006917,-12.58083855843057,0 -62.32655966438069,-12.57366818219226,0 -62.31266907699298,-12.55756782265397,0 -62.29866704618343,-12.54815500688484,0 -62.28942178125207,-12.53524765259619,0 -62.28013578039388,-12.52985418442191,0 -62.2677560432923,-12.50980547032473,0 -62.27052805311359,-12.48857802338899,0 -62.26833587946073,-12.48104228198958,0 -62.2719741593667,-12.48055576079989,0 -62.2750254783422,-12.47325579499861,0 -62.26736127873851,-12.45657160209987,0 -62.25875336347374,-12.45094812121202,0 -62.26205410425314,-12.43614402934608,0 -62.25883450937663,-12.43328540603585,0 -62.26416734541007,-12.42736654471645,0 -62.25202634215839,-12.42257515253634,0 -62.25511623692923,-12.4144317177702,0 -62.25196994105266,-12.40980652570979,0 -62.25566775077488,-12.41038370938656,0 -62.25085972785309,-12.40206725974455,0 -62.2838402767523,-12.33431115632112,0 -62.29136126529264,-12.31885977860728,0 -62.30041507852488,-12.31640188872182,0 -62.30665960161565,-12.32102288764255,0 -62.32878626850044,-12.32594589693915,0 -62.35525037404615,-12.3321783273292,0 -62.36355458336817,-12.33874009356313,0 -62.37339131699999,-12.33798379945223,0 -62.38055740902658,-12.34259103291231,0 -62.39461519388011,-12.34351459309533,0 -62.40678096521094,-12.33249926237312,0 -62.41594252051134,-12.32874657088199,0 -62.41753229495513,-12.32420450928574,0 -62.43853066916643,-12.31671548133949,0 -62.44405867626396,-12.31043307124072,0 -62.46275151186626,-12.30168826507222,0 -62.46813756239564,-12.29929465099336,0 -62.47708450867691,-12.30290464989191,0 -62.48544607852735,-12.30208413394278,0 -62.48936267955554,-12.29609280296237,0 -62.49825105013786,-12.29706368726221,0 -62.50172257011202,-12.29355524433999,0 -62.51347054144458,-12.28564958531435,0 -62.52042235297788,-12.28343278424435,0 -62.5355844556527,-12.28496826433715,0 -62.5561112385423,-12.27505492540313,0 -62.55999883510736,-12.26932335247164,0 -62.56761461366956,-12.27218397338306,0 -62.57627854359058,-12.26763877319165,0 -62.58244319495934,-12.25960968382519,0 -62.5826657425808,-12.25289199679978,0 -62.59283329911821,-12.24910471916085,0 -62.60281046772023,-12.25135363181127,0 -62.60836764451795,-12.25625611473806,0 -62.60928350805997,-12.25389068780349,0 -62.62221992570172,-12.25435766046242,0 -62.64245370748815,-12.23721827169658,0 -62.63428368265234,-12.21866030539214,0 -62.62202872377176,-12.20773965077891,0 -62.61752858462562,-12.20902330021899,0 -62.61291304559722,-12.19964648953779,0 -62.61580678269313,-12.19705990248627,0 -62.61444662058104,-12.18887966124797,0 -62.6208878384407,-12.18337507738108,0 -62.61478231171424,-12.17063443355126,0 -62.60389286258045,-12.15879398094392,0 -62.60244488167034,-12.15047021598725,0 -62.60972461082574,-12.12858443187852,0 -62.606745335534,-12.12624237826413,0 -62.61385695166374,-12.11996760933681,0 -62.60769307000838,-12.1117896567533,0 -62.60455255382399,-12.11187528888657,0 -62.60978134200549,-12.10128436783251,0 -62.60628273495228,-12.10083515057547,0 -62.60847168773973,-12.09635355126433,0 -62.60625213372595,-12.09247233715535,0 -62.60985693319439,-12.09171499448873,0 -62.60646641648071,-12.0897100665924,0 -62.61008026108524,-12.08949107859667,0 -62.61138805403446,-12.08501508128558,0 -62.58846846274264,-12.06927815762995,0 -62.58166803448104,-12.0727076791838,0 -62.58094389641544,-12.06961241852858,0 -62.57702591287712,-12.07008263034331,0 -62.56491365243,-12.05943310636023,0 -62.54513658852422,-12.04872505909518,0 -62.54733415205553,-12.03922689192228,0 -62.54416218137525,-12.03454547464429,0 -62.53880176455412,-12.03330107048582,0 -62.53785555838615,-12.0292026555895,0 -62.52296816715726,-12.02479433511408,0 -62.51646485075578,-12.01582687303325,0 -62.48850091351252,-12.00487305955676,0 -62.48336183538175,-11.99656721951573,0 -62.47943928253233,-11.99598942127528,0 -62.48046843233129,-11.98846589878347,0 -62.47552411184356,-11.98252811901522,0 -62.46799925006989,-11.98213476734365,0 -62.46460676842579,-11.97332107530626,0 -62.45441537951072,-11.9701069457577,0 -62.45409832621711,-11.96975033705835,0 -62.44811175133208,-11.9610509571057,0 -62.44118918834678,-11.95880370352291,0 -62.43821690932057,-11.94538485346226,0 -62.42878441432635,-11.93758242522818,0 -62.42824760974442,-11.93373252133267,0 -62.42330129676676,-11.93392477602609,0 -62.40608388836798,-11.92391410276283,0 -62.40721734829407,-11.91547546261935,0 -62.39154303545393,-11.90851895596055,0 -62.37971705376528,-11.90488093488771,0 -62.37447179574497,-11.9090008336178,0 -62.35788907995059,-11.90393314806933,0 -62.35032768156163,-11.90486658261126,0 -62.34697166305684,-11.89905634520999,0 -62.34118885824859,-11.90030890526926,0 -62.33715764167007,-11.89552800334821,0 -62.33036006865751,-11.8960597626923,0 -62.32130495777303,-11.90302820131267,0 -62.31871912886525,-11.90096574141105,0 -62.31577476155048,-11.90467856791214,0 -62.31582938469661,-11.9013634477888,0 -62.31247323284632,-11.90362534845601,0 -62.31130809454451,-11.90108173227957,0 -62.30715970306156,-11.89833856848678,0 -62.30475872333948,-11.90081608048217,0 -62.29931398408766,-11.89269731097526,0 -62.29060259691025,-11.89503246128576,0 -62.29152527977025,-11.89935973737175,0 -62.2880806539652,-11.90086476889907,0 -62.28366143963454,-11.8991703073549,0 -62.27841374436395,-11.90427964578081,0 -62.27363446689555,-11.90200990166581,0 -62.26758030975788,-11.90612544274249,0 -62.25816797143347,-11.90104210464071,0 -62.25774616756127,-11.90341914835719,0 -62.24612959556158,-11.90152332921303,0 -62.24144041997333,-11.90330218918069,0 -62.24383034148475,-11.90576716509693,0 -62.24127101821998,-11.90831181157998,0 -62.23594105341264,-11.91037428310172,0 -62.23216742165178,-11.90806832866121,0 -62.22623086050021,-11.89039996770831,0 -62.20663050120177,-11.8320248102307,0 -62.1992156610067,-11.8279090136096,0 -62.18938427997176,-11.82797704317588,0 -62.17324749874143,-11.85225167397297,0 -62.18254881082289,-11.86729196449489,0
 * 					</coordinates>
 * 				</LinearRing>
 * 			</outerBoundaryIs>
 * 		</Polygon>
 * 	</Placemark>
 * 	</code></pre>
 */
@Singleton
public class LeitorMunicipiosArquivoKML implements LeitorMunicipios {

    public static final String TAG_DELIMITADORA_PASTA = "Folder";
    public static final String TAG_DELIMITADORA_SCHEMA = "SchemaData";

    public static final String TAG_DELIMITADORA_MUNICIPIO = "Placemark";
    public static final String TAG_DELIMITADORA_DADOS_MUNICIPIO = "ExtendedData";
    public static final String TAG_DELIMITADORA_PROPRIEDADE_MUNICIPIO = "SimpleData";

    public static final String TAG_NOME_ATRIBUTO = "name";
    public static final String NOME_ATRIBUTO_GEOCODIGO = "GEOCODIGO_MUNICIPIO";
    public static final String NOME_ATRIBUTO_SIGLA_UF = "SIGLA";
    public static final String NOME_ATRIBUTO_NOME = "NOME_MUNICIPIO";

    public static final String TAG_DELIMITADORA_MULTIGEOMETRICA = "MultiGeometry";

    public static final String TAG_DELIMITADORA_POLIGONO = "Polygon";
    public static final String TAG_DELIMITADORA_LIMITES_EXTERNOS = "outerBoundaryIs";
    public static final String TAG_DELIMITADORA_ANEL_LINEAR = "LinearRing";
    public static final String TAG_DELIMITADORA_COORDENADAS = "coordinates";


    private final URL caminhoArquivoKml;

    /**
     * Construtor do leitor de municípios.
     *
     * @param caminhoArquivoKml O caminho do arquivo KML.
     */
    @Inject
    public LeitorMunicipiosArquivoKML(@Nonnull final URL caminhoArquivoKml) {
        this.caminhoArquivoKml = checkNotNull(caminhoArquivoKml);
    }

    /**
     * Lê os municípios no arquivo de caminho fornecido.
     *
     * @return Todos os municípios encontrados no arquivo.
     * @throws IOException Se algum erro na leitura do arquivo ocorrer.
     */
    @Override
    public List<Municipio> lerMunicipios() throws IOException {
        final Document documentoKml;

        try (final InputStream inputStream = new BufferedInputStream(Files.newInputStream(Paths.get(caminhoArquivoKml.toURI())))) {
            documentoKml = DocumentBuilderFactory.newInstance().newDocumentBuilder().parse(inputStream);
        } catch (ParserConfigurationException | SAXException | URISyntaxException exception) {
            throw new IOException("Um erro ocorreu na leitura do arquivo KML.", exception);
        }

        final List<Municipio> municipios = new ArrayList<Municipio>();

        final Element elementoRaiz = documentoKml.getDocumentElement();

        if (!elementoRaiz.getNodeName().equals("kml")) {
            throw new IOException("O arquivo contendo os municípios precisa ser um arquivo KML.");
        }

        Node noFolder = obterNoFolder(elementoRaiz);

        for (final Node noMunicipio : obterMunicipios(noFolder)) {
            final NodeList noMunicipioChildNodes = noMunicipio.getChildNodes();

            long geocodigo = -1;
            String siglaUF = null;
            String nome = null;
            AreaMunicipio areaMunicipio = null;

            for (int i = 0; i < noMunicipioChildNodes.getLength(); i++) {
                final Node noMunicipioChildNodesItem = noMunicipioChildNodes.item(i);

                // leitura dos dados do município

                if (noMunicipioChildNodesItem.getNodeType() == Node.ELEMENT_NODE && noMunicipioChildNodesItem.getNodeName().equals(TAG_DELIMITADORA_DADOS_MUNICIPIO)) {
                    final NodeList noExtendedDataChildNodes = noMunicipioChildNodesItem.getChildNodes();

                    for (int j = 0; j < noExtendedDataChildNodes.getLength(); j++) {
                        final Node noExtendedDataChildNodesItem = noExtendedDataChildNodes.item(j);

                        if (noExtendedDataChildNodesItem.getNodeType() == Node.ELEMENT_NODE && noExtendedDataChildNodesItem.getNodeName().equals(TAG_DELIMITADORA_SCHEMA)) {
                            final Node noSchema = noExtendedDataChildNodesItem;

                            geocodigo = lerGeocodigo(noSchema);
                            nome = lerNome(noSchema);
                            siglaUF = lerSiglaUF(noSchema);
                        }
                    }
                }

                // leitura da área com múltiplos polígonos

                if (noMunicipioChildNodesItem.getNodeType() == Node.ELEMENT_NODE && noMunicipioChildNodesItem.getNodeName().equals(TAG_DELIMITADORA_MULTIGEOMETRICA)) {
                    final List<Poligono> poligonos = new ArrayList<>();

                    final NodeList noMultigeometria = noMunicipioChildNodesItem.getChildNodes();

                    for (int j = 0; j < noMultigeometria.getLength(); j++) {
                        final Node noMultigeometriaItem = noMultigeometria.item(j);

                        if (noMultigeometriaItem.getNodeType() == Node.ELEMENT_NODE && noMultigeometriaItem.getNodeName().equals(TAG_DELIMITADORA_POLIGONO)) {
                            poligonos.add(lerPoligono(noMultigeometriaItem));
                        }
                    }

                    areaMunicipio = new AreaMunicipio(poligonos);
                }

                // leitura da área com um único polígono

                if (noMunicipioChildNodesItem.getNodeType() == Node.ELEMENT_NODE && noMunicipioChildNodesItem.getNodeName().equals(TAG_DELIMITADORA_POLIGONO)) {
                    areaMunicipio = new AreaMunicipio(lerPoligono(noMunicipioChildNodesItem));
                }
            }

            municipios.add(new Municipio(geocodigo, siglaUF, nome, areaMunicipio));
        }

        return municipios;
    }

    /**
     * Obtém o nó <code>Folder</code> a partir do elemento raíz fornecido.
     *
     * @param elementoRaiz O elemento raíz do documento KML.
     * @return O nó <code>Folder</code>.
     * @throws IOException Se o nó <code>Folder</code> não pôde ser encontrado.
     */
    private Node obterNoFolder(@Nonnull final Element elementoRaiz) throws IOException {
        final NodeList elementoRaizChildNodes = elementoRaiz.getChildNodes();

        for (int i = 0; i < elementoRaizChildNodes.getLength(); i++) {
            final Node elementoRaizChildNodesItem = elementoRaizChildNodes.item(i);

            if (elementoRaizChildNodesItem.getNodeType() == Node.ELEMENT_NODE && elementoRaizChildNodesItem.getNodeName().equals(TAG_DELIMITADORA_PASTA)) {
                return elementoRaizChildNodesItem;
            }
        }

        throw new IOException("O nó Folder não pôde ser encontrada no elemento fornecido.");
    }

    /**
     * Obtém os nós {@link #TAG_DELIMITADORA_MUNICIPIO} representando os municípios.
     *
     * @param noFolder O nó {@link #TAG_DELIMITADORA_PASTA} contendo os municípios.
     * @return Os nós representando os municípios.
     */
    private List<Node> obterMunicipios(@Nonnull final Node noFolder) {
        final List<Node> nosMunicipios = new ArrayList<>();

        final NodeList noFolderChildNodes = noFolder.getChildNodes();

        for (int i = 0; i < noFolderChildNodes.getLength(); i++) {
            final Node noFolderChildNodesItem = noFolderChildNodes.item(i);

            if (noFolderChildNodesItem.getNodeType() == Node.ELEMENT_NODE && noFolderChildNodesItem.getNodeName().equals(TAG_DELIMITADORA_MUNICIPIO)) {
                nosMunicipios.add(noFolderChildNodesItem);
            }
        }

        return nosMunicipios;
    }

    /**
     * A partir do nó {@link #TAG_DELIMITADORA_SCHEMA}, obtém o valor da propriedade {@link #NOME_ATRIBUTO_GEOCODIGO}.
     *
     * @param noSchema O nó {@link #TAG_DELIMITADORA_SCHEMA}.
     * @return O valor da propriedade.
     * @throws IOException Se a propriedade não for encontrada.
     */
    private long lerGeocodigo(@Nonnull final Node noSchema) throws IOException {
        final NodeList noSchemaChildNodes = noSchema.getChildNodes();

        for (int i = 0; i < noSchemaChildNodes.getLength(); i++) {
            final Node noSchemaChildNodesItem = noSchemaChildNodes.item(i);

            if (noSchemaChildNodesItem.getNodeType() == Node.ELEMENT_NODE && noSchemaChildNodesItem.getNodeName().equals(TAG_DELIMITADORA_PROPRIEDADE_MUNICIPIO) && ((Element) noSchemaChildNodesItem).getAttribute(TAG_NOME_ATRIBUTO).equals(NOME_ATRIBUTO_GEOCODIGO)) {
                return Long.parseLong(noSchemaChildNodesItem.getTextContent());
            }
        }

        throw new IOException("A propriedade geocódigo não pôde ser encontrada no nó fornecido.");
    }

    /**
     * A partir do nó {@link #TAG_DELIMITADORA_SCHEMA}, obtém o valor da propriedade {@link #NOME_ATRIBUTO_SIGLA_UF}.
     *
     * @param noSchema O nó {@link #TAG_DELIMITADORA_SCHEMA}.
     * @return O valor da propriedade, <code>null</code> caso não seja encontrada.
     * @throws IOException Se a propriedade não for encontrada.
     */
    private String lerSiglaUF(@Nonnull final Node noSchema) throws IOException {
        final NodeList noSchemaChildNodes = noSchema.getChildNodes();

        for (int i = 0; i < noSchemaChildNodes.getLength(); i++) {
            final Node noSchemaChildNodesItem = noSchemaChildNodes.item(i);

            if (noSchemaChildNodesItem.getNodeType() == Node.ELEMENT_NODE && noSchemaChildNodesItem.getNodeName().equals(TAG_DELIMITADORA_PROPRIEDADE_MUNICIPIO) && ((Element) noSchemaChildNodesItem).getAttribute(TAG_NOME_ATRIBUTO).equals(NOME_ATRIBUTO_SIGLA_UF)) {
                return noSchemaChildNodesItem.getTextContent();
            }
        }

        return null; // null caso não haja informações sobre a UF do município.
    }

    /**
     * A partir do nó {@link #TAG_DELIMITADORA_SCHEMA}, obtém o valor da propriedade {@link #NOME_ATRIBUTO_NOME}.
     *
     * @param noSchema O nó {@link #TAG_DELIMITADORA_SCHEMA}.
     * @return O valor da propriedade, <code>null</code> caso não seja encontrado.
     * @throws IOException Se a propriedade não for encontrada.
     */
    private String lerNome(@Nonnull final Node noSchema) throws IOException {
        final NodeList noSchemaChildNodes = noSchema.getChildNodes();

        for (int i = 0; i < noSchemaChildNodes.getLength(); i++) {
            final Node noSchemaChildNodesItem = noSchemaChildNodes.item(i);

            if (noSchemaChildNodesItem.getNodeType() == Node.ELEMENT_NODE && noSchemaChildNodesItem.getNodeName().equals(TAG_DELIMITADORA_PROPRIEDADE_MUNICIPIO) && ((Element) noSchemaChildNodesItem).getAttribute(TAG_NOME_ATRIBUTO).equals(NOME_ATRIBUTO_NOME)) {
                return noSchemaChildNodesItem.getTextContent();
            }
        }

        return null; // null caso não haja informações sobre o nome do município.
    }

    /**
     * Método auxiliar para captura de dados sobre os polígonos que compõem a área do município.
     *
     * @param noPolygon O nó {@link #TAG_DELIMITADORA_POLIGONO}.
     * @return O polígono desserializado.
     * @throws IOException Se os dados do polígonos não forem encontrados.
     */
    private Poligono lerPoligono(@Nonnull final Node noPolygon) throws IOException {
        final List<Coordenada> coordenadas = new ArrayList<>();

        final NodeList noPolygonChildNodes = noPolygon.getChildNodes();

        for (int i = 0; i < noPolygonChildNodes.getLength(); i++) {
            final Node noPolygonChildNodesItem = noPolygonChildNodes.item(i);

            if (noPolygonChildNodesItem.getNodeType() == Node.ELEMENT_NODE && noPolygonChildNodesItem.getNodeName().equals(TAG_DELIMITADORA_LIMITES_EXTERNOS)) {
                final NodeList noOuterBoundaryIsChildNodes = noPolygonChildNodesItem.getChildNodes();

                for (int j = 0; j < noOuterBoundaryIsChildNodes.getLength(); j++) {
                    final Node noOuterBoundaryIsChildNodesItem = noOuterBoundaryIsChildNodes.item(j);

                    if (noOuterBoundaryIsChildNodesItem.getNodeType() == Node.ELEMENT_NODE && noOuterBoundaryIsChildNodesItem.getNodeName().equals(TAG_DELIMITADORA_ANEL_LINEAR)) {
                        final NodeList noLinearRingChildNodes = noOuterBoundaryIsChildNodesItem.getChildNodes();

                        for (int k = 0; k < noLinearRingChildNodes.getLength(); k++) {
                            final Node noLinearRingChildNodesItem = noLinearRingChildNodes.item(k);

                            if (noLinearRingChildNodesItem.getNodeType() == Node.ELEMENT_NODE && noLinearRingChildNodesItem.getNodeName().equals(TAG_DELIMITADORA_COORDENADAS)) {

                                final Element noCoordenadas = (Element) noLinearRingChildNodesItem;

                                final String noCoordenadasValor = noCoordenadas.getTextContent().trim();

                                for (final String valoresCoordenadas : noCoordenadasValor.split(",0 ")) {
                                    final String[] longitudeLatitude = valoresCoordenadas.split(",");

                                    final double longitude = Double.parseDouble(longitudeLatitude[0]);
                                    final double latitude = Double.parseDouble(longitudeLatitude[1]);

                                    coordenadas.add(new Coordenada(latitude, longitude));
                                }
                            }
                        }
                    }
                }
            }
        }

        if (coordenadas.isEmpty()) {
            throw new IOException("Os dados do polígono não foram encontrados.");
        }

        return new Poligono(coordenadas);
    }

}
